---
import { Image } from 'astro:assets';

// Importar im√°genes destacadas para las cards
import card1 from '../assets/facebook/card1.jpeg';
import card2 from '../assets/facebook/card2.jpeg';
import card3 from '../assets/facebook/card3.jpeg';
import card4 from '../assets/facebook/card4.jpeg';
import card5 from '../assets/facebook/card5.jpeg';
import card6 from '../assets/facebook/card6.jpeg';
import card7 from '../assets/facebook/card7.jpeg';
import card8 from '../assets/facebook/card8.jpeg';
import card9 from '../assets/facebook/card9.jpeg';

// Importar im√°genes para el carrusel (de Facebook)
import carrusel1 from '../assets/facebook/carrusel1.jpeg';
import carrusel3 from '../assets/facebook/carrusel3.jpeg';
import carrusel4 from '../assets/facebook/carrusel4.jpeg';
import carrusel6 from '../assets/facebook/carrusel6.jpeg';
import carrusel7 from '../assets/facebook/carrusel7.jpeg';
import carrusel9 from '../assets/facebook/carrusel9.jpeg';
import carrusel10 from '../assets/facebook/carrusel10.jpeg';
import carrusel12 from '../assets/facebook/carrusel12.jpeg';
import carrusel13 from '../assets/facebook/carrusel13.jpeg';

// Importar im√°genes para el carrusel (de WhatsApp)
import carrusel2 from '../assets/whatsapp/carrusel2.jpeg';
import carrusel5 from '../assets/whatsapp/carrusel5.jpeg';
import carrusel8 from '../assets/whatsapp/carrusel8.jpeg';
import carrusel11 from '../assets/whatsapp/carrusel11.jpeg';
import carrusel14 from '../assets/whatsapp/carrusel14.jpeg';

// Importar collages
import collageFacebook from '../assets/facebook/collage-facebook.png';
import collageWhatsapp from '../assets/whatsapp/collage-whatsapp.png';

const comentariosDestacados = [
  { imagen: card1, alt: 'Comentario destacado 1' },
  { imagen: card2, alt: 'Comentario destacado 2' },
  { imagen: card3, alt: 'Comentario destacado 3' },
  { imagen: card4, alt: 'Comentario destacado 4' },
  { imagen: card5, alt: 'Comentario destacado 5' },
  { imagen: card6, alt: 'Comentario destacado 6' },
  { imagen: card7, alt: 'Comentario destacado 7' },
  { imagen: card8, alt: 'Comentario destacado 8' },
  { imagen: card9, alt: 'Comentario destacado 9' },
];

const carruselImagenes = [
  { imagen: carrusel1, alt: 'Opini√≥n 1' },
  { imagen: carrusel2, alt: 'Opini√≥n 2' },
  { imagen: carrusel3, alt: 'Opini√≥n 3' },
  { imagen: carrusel4, alt: 'Opini√≥n 4' },
  { imagen: carrusel5, alt: 'Opini√≥n 5' },
  { imagen: carrusel6, alt: 'Opini√≥n 6' },
  { imagen: carrusel7, alt: 'Opini√≥n 7' },
  { imagen: carrusel8, alt: 'Opini√≥n 8' },
  { imagen: carrusel9, alt: 'Opini√≥n 9' },
  { imagen: carrusel10, alt: 'Opini√≥n 10' },
  { imagen: carrusel11, alt: 'Opini√≥n 11' },
  { imagen: carrusel12, alt: 'Opini√≥n 12' },
  { imagen: carrusel13, alt: 'Opini√≥n 13' },
  { imagen: carrusel14, alt: 'Opini√≥n 14' },
];
---

<section id="testimonios" class="py-20 bg-white">
  <div class="container mx-auto px-4">
    
    <!-- 1Ô∏è‚É£ SUB-SECCI√ìN: Comentarios destacados -->
    <div class="mb-20">
      <!-- Header -->
      <div class="text-center mb-12">
        <span class="inline-block text-5xl mb-4">üíñ</span>
        <h2 class="font-fredoka text-4xl md:text-5xl font-bold text-gray-800 mb-4">
          Lo que dicen nuestros clientes en redes
        </h2>
        <p class="text-xl text-gray-600 max-w-3xl mx-auto">
          Sus palabras son el reflejo de la emoci√≥n que compartimos en cada sorpresa.
        </p>
      </div>

      <!-- Grid de comentarios destacados -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {comentariosDestacados.map((comentario, index) => (
          <div 
            class="overflow-hidden rounded-2xl shadow-md hover:shadow-xl transition-all duration-300 transform hover:scale-105"
            style={`animation-delay: ${index * 0.1}s`}
          >
            <Image
              src={comentario.imagen}
              alt={comentario.alt}
              class="w-full h-auto object-cover"
              loading="lazy"
            />
          </div>
        ))}
      </div>
    </div>

    <!-- 2Ô∏è‚É£ SUB-SECCI√ìN: M√°s opiniones felices (Carrusel) -->
    <div class="mb-20">
      <!-- Header -->
      <div class="text-center mb-12">
        <span class="inline-block text-5xl mb-4">‚ú®</span>
        <h2 class="font-fredoka text-4xl md:text-5xl font-bold text-gray-800 mb-4">
          Miles de sonrisas compartidas
        </h2>
      </div>

      <!-- Carrusel Container -->
      <div class="relative overflow-hidden">
        <!-- Bot√≥n Anterior -->
        <button 
          id="prev-btn"
          class="absolute left-2 top-1/2 -translate-y-1/2 z-10 bg-white/90 hover:bg-white rounded-full p-3 shadow-lg transition-all duration-300 hover:scale-110"
          aria-label="Anterior"
        >
          <svg class="w-6 h-6 text-pink-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
        </button>

        <!-- Bot√≥n Siguiente -->
        <button 
          id="next-btn"
          class="absolute right-2 top-1/2 -translate-y-1/2 z-10 bg-white/90 hover:bg-white rounded-full p-3 shadow-lg transition-all duration-300 hover:scale-110"
          aria-label="Siguiente"
        >
          <svg class="w-6 h-6 text-pink-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </button>

        <!-- Carrusel Track -->
        <div id="carousel-track" class="flex gap-4 transition-transform duration-500 ease-in-out">
          {carruselImagenes.map((imagen) => (
            <div class="flex-shrink-0 w-80 md:w-96 carousel-item">
              <div class="rounded-xl overflow-hidden shadow-md hover:shadow-lg transition-shadow duration-300">
                <Image
                  src={imagen.imagen}
                  alt={imagen.alt}
                  class="w-full h-auto object-cover"
                  loading="lazy"
                />
              </div>
            </div>
          ))}
          <!-- Duplicar im√°genes para loop infinito -->
          {carruselImagenes.map((imagen) => (
            <div class="flex-shrink-0 w-80 md:w-96 carousel-item">
              <div class="rounded-xl overflow-hidden shadow-md hover:shadow-lg transition-shadow duration-300">
                <Image
                  src={imagen.imagen}
                  alt={imagen.alt}
                  class="w-full h-auto object-cover"
                  loading="lazy"
                />
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  const AUTOPLAY_DELAY = 3000;   
  const AUTOPLAY_INTERVAL = 5000;
  const TRANSITION_SPEED = 800;  
  const track = document.getElementById('carousel-track');
  const prevBtn = document.getElementById('prev-btn');
  const nextBtn = document.getElementById('next-btn');
  
  if (track && prevBtn && nextBtn) {
    let currentIndex = 0;
    const items = Array.from(track.children);
    const originalItemCount = items.length / 2;
    
    function getSlideWidth() {
      if (items.length > 0 && track) {
        const firstItem = items[0] as HTMLElement;
        const itemWidth = firstItem.offsetWidth;
        const computedStyle = window.getComputedStyle(track);
        const gap = parseInt(computedStyle.gap) || 16;
        return itemWidth + gap;
      }
      return 0;
    }
    
    // Funci√≥n para mover el carrusel
    function moveCarousel(direction: number) {
      if (!track) return;
      
      const slideWidth = getSlideWidth();
      currentIndex += direction;
      
      // Si avanzamos y llegamos al final del primer set
      if (direction > 0 && currentIndex >= originalItemCount) {
        // Desactivar transici√≥n temporalmente
        track.style.transition = 'none';
        currentIndex = 0; // Resetear al inicio
        track.style.transform = `translateX(0px)`;
        
        // Forzar un reflow
        track.offsetHeight;
        
        // Reactivar transici√≥n con velocidad configurada
        setTimeout(() => {
          if (track) {
            track.style.transition = `transform ${TRANSITION_SPEED}ms ease-in-out`;
          }
        }, 20);
        return;
      }
      
      // Si retrocedemos desde el inicio
      if (direction < 0 && currentIndex < 0) {
        track.style.transition = 'none';
        currentIndex = originalItemCount - 1;
        const offset = -(currentIndex * slideWidth);
        track.style.transform = `translateX(${offset}px)`;
        
        // Forzar un reflow
        track.offsetHeight;
        
        setTimeout(() => {
          if (track) {
            track.style.transition = `transform ${TRANSITION_SPEED}ms ease-in-out`;
          }
        }, 20);
        return;
      }
      
      const offset = -(currentIndex * slideWidth);
      track.style.transform = `translateX(${offset}px)`;
    }
    
    // Event listeners para botones
    prevBtn.addEventListener('click', () => moveCarousel(-1));
    nextBtn.addEventListener('click', () => moveCarousel(1));
    
    let autoplayInterval: ReturnType<typeof setInterval>;
    
    function startAutoplay() {
      autoplayInterval = setInterval(() => moveCarousel(1), AUTOPLAY_INTERVAL);
    }
    
    function stopAutoplay() {
      clearInterval(autoplayInterval);
    }
    
    // Iniciar autoplay despu√©s del delay inicial
    setTimeout(() => {
      startAutoplay();
    }, AUTOPLAY_DELAY);
    
    // Pausar autoplay cuando se hace clic en los botones
    prevBtn.addEventListener('click', () => {
      stopAutoplay();
      setTimeout(startAutoplay, 2000);
    });
    
    nextBtn.addEventListener('click', () => {
      stopAutoplay();
      setTimeout(startAutoplay, 2000);
    });
    
    // Recalcular posici√≥n al cambiar el tama√±o de la ventana
    let resizeTimeout: ReturnType<typeof setTimeout>;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        if (track) {
          const slideWidth = getSlideWidth();
          const offset = -(currentIndex * slideWidth);
          track.style.transform = `translateX(${offset}px)`;
        }
      }, 100);
    });
  }
</script>

<style>
  #carousel-track {
    will-change: transform;
  }
  
  @media (max-width: 768px) {
    #carousel-track > div {
      width: 320px;
    }
  }
</style>
